(function(o,p){typeof exports=="object"&&typeof module!="undefined"?module.exports=p(require("vue")):typeof define=="function"&&define.amd?define(["vue"],p):(o=typeof globalThis!="undefined"?globalThis:o||self,o.n=p(o.Vue))})(this,function(o){"use strict";function p(e){document.body.append(e)}function f(e,t,n){n!==void 0?e.style[t]=n:e.style=t}function C(e,t){e.addEventListener("transitionend",t,{once:!0})}const r={modalDom:null,initZIndex:null,zIndex:null,appended:!1,nextzIndex(){return this.zIndex+=2}};window.pop=r;function V(e){if(document.body.style.overflow="hidden",r.modalDom===null){const n=document.createElement("div");n.className="mg-modal",r.modalDom=n}let t=r.modalDom;r.appended?f(t,"z-index",r.nextzIndex()):(f(t,"z-index",r.zIndex),p(t),r.appended=!0)}function I(e){const t=e?.5:0;getComputedStyle(r.modalDom).opacity,f(r.modalDom,"opacity",t)}function x(){const e=r.modalDom;if(!e)return!1;const t=e.style.zIndex-4;return t>=r.initZIndex?(f(e,"z-index",t),r.zIndex=t+2):(r.zIndex-=2,C(e,()=>{document.body.removeChild(e),r.appended=!1}),document.body.style.overflow="",I()),!0}var D=Object.defineProperty,S=Object.prototype.hasOwnProperty,P=Object.getOwnPropertySymbols,E=Object.prototype.propertyIsEnumerable,h=(e,t,n)=>t in e?D(e,t,{enumerable:!0,configurable:!0,writable:!0,value:n}):e[t]=n,w=(e,t)=>{for(var n in t||(t={}))S.call(t,n)&&h(e,n,t[n]);if(P)for(var n of P(t))E.call(t,n)&&h(e,n,t[n]);return e};const $=o.ref(null);var y=o.defineComponent({name:"MgImgPreview",props:{ops:{default:!1},src:{default:"",type:String},disabled:{}},emits:["close","closed"],setup(e,t){const n=o.ref(0),u=o.ref(!1),c=o.ref({}),d=o.ref({});let i,b,k,B,g,v;const H=s=>{if(e.disabled!==void 0)return;const a=s.target,m=a.getBoundingClientRect();i=m.x,b=m.y,k=m.width,B=m.height,g=a.naturalWidth,v=a.naturalHeight,N(),V(),n.value=r.nextzIndex(),u.value=!0,I(!0),window.addEventListener("resize",z)},T=()=>{t.emit("close"),C($.value,()=>{u.value=!1,c.value={},d.value={transform:d.value.transform},l.scale=1,l.rotate=0,t.emit("closed")}),window.removeEventListener("resize",z),N(),x()},l=o.reactive({translate3d:"",scale:1,rotate:0});o.watch(l,()=>{const s=w({},d.value);s.transform=`translate3d(${l.translate3d}) scale(${l.scale}) rotate(${l.rotate}deg)`,d.value=s},{deep:!0});const N=()=>{c.value={width:k,height:B},l.translate3d=`${i}px,${b}px,0`},z=()=>{let s=window.innerHeight,a=window.innerWidth;c.value={width:g,height:v};let m=s-v,W=a*.9-g;l.translate3d=`${W>0?(a-g)/2:a*.05}px,${m>0?m/2+"px":e.ops?0:"1.5rem"},0`};return{previewing:u,zIndex:n,imgStyle:d,imgAttr:c,viewingImg:$,startPreview:H,calcedPosi:z,stopPrev:T,orgsize:()=>{l.scale=1,d.value=w(w({},d.value),{"max-height":"none","max-width":"none"})},zoom:s=>{l.scale+=s},rotate:s=>{l.rotate+=s}}}});const F={key:0,class:"mg-prev-ops"};function O(e,t,n,u,c,d){return o.openBlock(),o.createBlock(o.Fragment,null,[o.createVNode("img",o.mergeProps({class:["mg-prev-img",e.disabled===void 0?null:"prev-disable"],src:e.src,onClick:t[1]||(t[1]=o.withModifiers(i=>e.startPreview(i),["self"]))},e.$attrs),null,16,["src"]),e.previewing?(o.openBlock(),o.createBlock(o.Teleport,{key:0,to:"body"},[o.createVNode("div",{class:"mg-imgpreview-warp",style:{zIndex:e.zIndex},onClick:t[8]||(t[8]=o.withModifiers((...i)=>e.stopPrev&&e.stopPrev(...i),["self"]))},[o.createVNode("img",o.mergeProps({ref:"viewingImg",onLoad:t[2]||(t[2]=(...i)=>e.calcedPosi&&e.calcedPosi(...i)),src:e.src},e.imgAttr,{style:e.imgStyle}),null,16,["src"]),e.ops?(o.openBlock(),o.createBlock("div",F,[o.createVNode("i",{class:"mg-icon-zoom-out",title:"\u653E\u5927",onClick:t[3]||(t[3]=i=>e.zoom(.1))}),o.createVNode("i",{class:"mg-icon-zoom-in",title:"\u7F29\u5C0F",onClick:t[4]||(t[4]=i=>e.zoom(-.1))}),o.createVNode("i",{class:"mg-icon-orgsize",title:"\u539F\u59CB\u6BD4\u4F8B",onClick:t[5]||(t[5]=(...i)=>e.orgsize&&e.orgsize(...i))},"1:1"),o.createVNode("i",{class:"mg-icon-refresh-left",title:"\u5DE6\u65CB\u8F6C",onClick:t[6]||(t[6]=i=>e.rotate(-90))}),o.createVNode("i",{class:"mg-icon-refresh-right",title:"\u53F3\u65CB\u8F6C",onClick:t[7]||(t[7]=i=>e.rotate(90))})])):o.createCommentVNode("v-if",!0)],4)])):o.createCommentVNode("v-if",!0)],64)}y.render=O;var M={name:"MgImgPreview",install(e,t={}){e.component(y.name,y)}};return M});
